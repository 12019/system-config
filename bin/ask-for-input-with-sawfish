#!/bin/bash

prompt="> "
TEMP=$(getopt -o p: --long prompt: -n $(basename $0) -- "$@")
eval set -- "$TEMP"
while true; do
    case "$1" in
        -p|--prompt)
            prompt=$2
            shift 2
            ;;
        --)
            shift
            break
            ;;
        *)
            die "internal error"
            ;;
    esac
done

tmpf=/tmp/$(basename $0).$$

echo "$prompt" > $tmpf

read_file=$(cat <<EOF
(progn
  (let* ((file (open-file "$tmpf" 'read))
         (str "")
         (line ""))
    (while (setq line (read-line file))
      (setq str (concat str line)))
    (close-file file)
    str))
EOF
)

sawfish-client -e "(let* ((prompt-completion-fun (lambda ())))
                     (prompt $read_file nil))" | perl -npe 's/^"|"$//g' | tr -d '\r\n'

rm $tmpf
