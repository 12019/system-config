#!/usr/bin/ruby

require 'xmlsimple'

if ARGV.size != 2
  puts "Error: usage: ruby-merge-xmls arg1 arg2"
  exit 1
end

x1 = XmlSimple.xml_in(ARGV[0], { 'keeproot' => true })
x2 = XmlSimple.xml_in(ARGV[1], { 'keeproot' => true })
puts x1
puts x2
puts XmlSimple.xml_out(x1, { 'keeproot' => true })
puts XmlSimple.xml_out(x2, { 'keeproot' => true })

x1.each do |k, v|
  v[0].each do |ck, cv|
    puts "looking at #{k} and #{v}: #{ck} and #{cv}"
    if not x2[k][0][ck]
      puts "not defined: #{k}[#{ck}]"
      x2[k][0][ck] = cv
    elsif x2[k][0][ck].is_a? Array
      x2[k][0][ck] += x1[k][0][ck]
    end
  end
end

print XmlSimple.xml_out(x2, { 'keeproot' => true })
